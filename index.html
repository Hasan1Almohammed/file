<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>رفع ومشاركة ملفات</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    min-height: 100vh;
}

/* العناوين */
h2 { margin-bottom: 15px; text-align:center; }

/* الملفات */
#files { margin-top:20px; display:flex; flex-direction:column; gap:12px; }
.file {
    padding:15px;
    border-radius:12px;
    border:1px solid #ccc;
    display:flex;
    flex-direction:column;
    gap:10px;
}

/* الأزرار */
button {
    padding: 8px 12px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}
.btn-upload { background:#2196f3; color:#fff; }
.btn-copy { background:#4caf50; color:#fff; }
.btn-delete { background:#f44336; color:#fff; }

.file-actions { display:flex; flex-wrap:wrap; gap:10px; }

input[type="file"] {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 100%;
}

footer {
    margin-top: 30px;
    text-align:center;
    font-size:14px;
    opacity:0.7;
}

@media(max-width:600px){
    .file-actions { flex-direction: column; }
    button { width:100%; }
}
</style>
</head>
<body>

<h2>رفع ملف (أي نوع)</h2>
<input type="file" id="fileInput">
<button class="btn-upload" onclick="uploadFile()">رفع الملف</button>

<hr>

<h2>الملفات</h2>
<div id="files"></div>

<footer>
    Developer by Hasan | © 2026
</footer>

<script>
const supabaseClient = supabase.createClient(
 "https://tlmkjawlfszsxtdszvol.supabase.co",
 "sb_publishable_qYUNJQIlY_w12AXUwSAW_Q_l89ThqTB"
);

// رفع ملف
async function uploadFile() {
    const file = document.getElementById("fileInput").files[0];
    if(!file) return alert("اختر ملف");
    if(file.size > 50*1024*1024) return alert("الحد الأقصى 50MB");

    const fileName = crypto.randomUUID()+"_"+file.name;
    const { error } = await supabaseClient.storage
        .from("uploads")
        .upload(fileName, file);

    if(error) return alert("فشل رفع الملف");
    loadFiles();
}

// عرض الملفات
async function loadFiles() {
    const { data } = await supabaseClient.storage.from("uploads").list("");
    const box = document.getElementById("files");
    box.innerHTML = "";

    data.forEach(f => {
        const publicUrl = supabaseClient.storage
            .from("uploads")
            .getPublicUrl(f.name).data.publicUrl;

        box.innerHTML += `
        <div class="file">
            <b>${f.name}</b>
            <div class="file-actions">
                <button class="btn-copy" onclick="copyLink('${publicUrl}')">نسخ رابط التنزيل</button>
                <button class="btn-copy" onclick="downloadFile('${publicUrl}')">تنزيل</button>
                <button class="btn-delete" onclick="deleteFile('${f.name}')">حذف</button>
            </div>
        </div>`;
    });
}

// تنزيل مباشر
function downloadFile(url){
    const a = document.createElement("a");
    a.href = url;
    a.download = "";
    document.body.appendChild(a);
    a.click();
    a.remove();
}

// حذف مع تأكيد
async function deleteFile(name) {
    if(!confirm("هل أنت متأكد من حذف الملف؟")) return;
    await supabaseClient.storage.from("uploads").remove([name]);
    loadFiles();
}

// نسخ رابط
function copyLink(text){
    navigator.clipboard.writeText(text);
    alert("تم نسخ رابط التنزيل");
}

loadFiles();
</script>

</body>
</html>
