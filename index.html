<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>رفع ومشاركة الملفات</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    /* ===== إعدادات أساسية ===== */
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #121212;
        color: #eee;
        padding: 20px;
    }
    h2 { margin-bottom: 15px; color: #ffcc00; }

    /* ===== حاوية الملفات ===== */
    #files { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }

    .file {
        background: #1e1e1e;
        padding: 15px;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .file b { color: #ffdd57; }

    /* ===== الأزرار ===== */
    button {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
    }
    button:hover { transform: scale(1.05); }

    .btn-copy { background: #4caf50; color: #fff; }
    .btn-delete { background: #f44336; color: #fff; }
    .btn-upload { background: #2196f3; color: #fff; margin-top: 10px; }

    input[type="file"] {
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #333;
        background: #1e1e1e;
        color: #eee;
        width: 100%;
    }

    hr { border: 0; border-top: 1px solid #333; margin: 25px 0; }
</style>
</head>
<body>

<h2>رفع ملف (أي نوع)</h2>
<input type="file" id="fileInput">
<button class="btn-upload" onclick="uploadFile()">رفع الملف</button>

<hr>

<h2>الملفات</h2>
<div id="files"></div>

<script>
const SUPABASE_URL = "https://tlmkjawlfszsxtdszvol.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_qYUNJQIlY_w12AXUwSAW_Q_l89ThqTB";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// رفع ملف
async function uploadFile() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("اختر ملف");

    if (file.size > 20 * 1024 * 1024) return alert("الحد الأقصى: 20MB");

    const fileName = crypto.randomUUID() + "_" + file.name;
    const { error } = await supabaseClient.storage.from("uploads").upload(fileName, file);
    if (error) return alert("فشل رفع الملف");

    loadFiles();
}

// عرض الملفات
async function loadFiles() {
    const { data } = await supabaseClient.storage.from("uploads").list("");
    const box = document.getElementById("files");
    box.innerHTML = "";

    for (let f of data) {
        const link = `${location.origin}/file.html#${f.name}`;
        box.innerHTML += `
        <div class="file">
            <b>${f.name}</b>
            <div style="display:flex; gap:10px; flex-wrap: wrap;">
                <a href="${link}" target="_blank"><button class="btn-copy">فتح الملف</button></a>
                <button class="btn-copy" onclick="copyLink('${link}')">نسخ الرابط</button>
                <button class="btn-delete" onclick="deleteFile('${f.name}')">حذف</button>
            </div>
        </div>`;
    }
}

// حذف ملف
async function deleteFile(name) {
    await supabaseClient.storage.from("uploads").remove([name]);
    loadFiles();
}

// نسخ رابط
function copyLink(text) {
    navigator.clipboard.writeText(text);
    alert("تم نسخ الرابط");
}

// تحميل الملفات عند فتح الصفحة
loadFiles();
</script>

</body>
</html>
