<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø±ÙØ¹ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ù…Ù„ÙØ§Øª</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; padding:20px }
.file { border:1px solid #ccc; padding:10px; margin:8px 0 }
button { margin:4px }
</style>
</head>
<body>

<h2>Ø±ÙØ¹ Ù…Ù„Ù (Ø£ÙŠ Ù†ÙˆØ¹)</h2>
<input type="file" id="fileInput">
<button onclick="uploadFile()">Ø±ÙØ¹</button>

<hr>

<h2>Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
<div id="files"></div>

<script>
const SUPABASE_URL = "https://tlmkjawlfszsxtdszvol.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_qYUNJQIlY_w12AXUwSAW_Q_l89ThqTB";

const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
);

// â¬†ï¸ Ø±ÙØ¹ Ù…Ù„Ù (Ø¨Ø¯ÙˆÙ† ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù†ÙˆØ¹)
async function uploadFile() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

    // Ø­Ø¯ Ø§Ù„Ø­Ø¬Ù… ÙÙ‚Ø· (10MB)
    if (file.size > 10 * 1024 * 1024)
        return alert("Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB");

    const fileName = crypto.randomUUID() + "_" + file.name;

    const { error } = await supabaseClient
        .storage.from("uploads")
        .upload(fileName, file);

    if (error) return alert("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹");

    loadFiles();
}

// ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª
async function loadFiles() {
    const { data } = await supabaseClient
        .storage.from("uploads")
        .list("");

    const box = document.getElementById("files");
    box.innerHTML = "";

    data.forEach(f => {
        const link = `${location.origin}/file.html#${f.name}`;
        box.innerHTML += `
        <div class="file">
            <b>${f.name}</b><br>
            <a href="${link}" target="_blank">${link}</a><br>
            <button onclick="navigator.clipboard.writeText('${link}')">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            <button onclick="deleteFile('${f.name}')">Ø­Ø°Ù</button>
        </div>`;
    });
}

// âŒ Ø­Ø°Ù Ù…Ù„Ù
async function deleteFile(name) {
    await supabaseClient.storage
        .from("uploads")
        .remove([name]);
    loadFiles();
}

loadFiles();
</script>

</body>
</html>
